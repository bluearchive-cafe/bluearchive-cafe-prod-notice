<script>
  // 本地 API 相对路径
  const API_BASE = "/api/dash";

  // 从 URL 查询参数获取 uuid
  const urlParams = new URLSearchParams(window.location.search);
  const uuid = urlParams.get("uuid") || "未提供uuid";
  document.getElementById("uuidDisplay").textContent = uuid;

  if (uuid !== "未提供uuid") {
    // 页面加载时获取 JSON
    fetch(`${API_BASE}?uuid=${uuid}`)
      .then(res => res.text())
      .then(text => {
        try {
          const json = JSON.parse(text);
          document.getElementById("jsonDisplay").textContent = JSON.stringify(json, null, 2);
        } catch (e) {
          document.getElementById("jsonDisplay").textContent = "加载失败";
        }
      })
      .catch(err => {
        document.getElementById("jsonDisplay").textContent = "获取失败: " + err;
      });
  } else {
    document.getElementById("jsonDisplay").textContent = "没有 UUID，无法获取数据";
  }

  // 日语配音按钮
  document.getElementById("jpBtn").addEventListener("click", () => {
    if (uuid === "未提供uuid") return alert("没有 UUID");
    fetch(`${API_BASE}?uuid=${uuid}&table=cn&asset=jp&voice=jp`)
      .then(res => res.text())
      .then(text => {
        try {
          const json = JSON.parse(text);
          alert("日语配音设置成功:\n" + JSON.stringify(json, null, 2));
        } catch (e) {
          alert("加载失败");
        }
      })
      .catch(err => alert("请求失败: " + err));
  });

  // 中文配音按钮
  document.getElementById("cnBtn").addEventListener("click", () => {
    if (uuid === "未提供uuid") return alert("没有 UUID");
    fetch(`${API_BASE}?uuid=${uuid}&table=cn&asset=jp&voice=cn`)
      .then(res => res.text())
      .then(text => {
        try {
          const json = JSON.parse(text);
          alert("中文配音设置成功:\n" + JSON.stringify(json, null, 2));
        } catch (e) {
          alert("加载失败");
        }
      })
      .catch(err => alert("请求失败: " + err));
  });
</script>